<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame + AR.js Test</title>
    <!-- A-Frame本体 -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- AR.js拡張 -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@master/aframe/build/aframe-ar.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- カメラ -->
      <a-entity camera></a-entity>

      <!-- カスタムコンポーネントで制御 -->
      <a-marker preset="hiro" emitevents="true" id="hiroMarker" keep-visible>
        <a-entity 
          id="model"
          gltf-model="url(models/chaei.glb)"
          position="0 0 0"
          rotation="0 180 0"
          scale="0.5 0.5 0.5">
        </a-entity>
      </a-marker>
    </a-scene>

    <script>
      // ---- A-Frameコンポーネント定義 ----
      AFRAME.registerComponent('keep-visible', {
        init: function () {
          const marker = this.el;

          // マーカーの状態が更新されるたびに呼ばれる
          marker.addEventListener('markerFound', () => {
            console.log('✅ マーカー検出');
            this.setVisible(true);
          });

          marker.addEventListener('markerLost', () => {
            console.log('⚠️ マーカー見失ったけど非表示にしない');
            this.setVisible(true);
          });
        },
        // visible状態を上書きする関数
        setVisible: function (val) {
          // 子オブジェクトすべてに適用
          this.el.object3D.traverse((obj) => {
            obj.visible = val;
          });
        }
      });
    </script>
  </body>
</html>


