<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      <!-- カメラ -->
      <a-camera-static></a-camera-static>

      <!-- マーカー -->
      <a-marker type="pattern" url="pattern-marker.patt" id="hiroMarker">
        <a-entity id="model"
                  gltf-model="model/chaei.glb"
                  scale="0.5 0.5 0.5"
                  position="0 0 0">
        </a-entity>
      </a-marker>

      <!-- 背景を保持するためのルート要素 -->
      <a-entity id="modelHolder"></a-entity>
    </a-scene>

    <script>
      const marker = document.querySelector("#hiroMarker");
      const model = document.querySelector("#model");
      const holder = document.querySelector("#modelHolder");
      let modelLocked = false;

      marker.addEventListener("markerFound", () => {
        console.log("✅ マーカーを検出！");
        if (!modelLocked) {
          model.setAttribute("visible", true);
          modelLocked = true;

          // マーカーの子要素を保持してシーン直下に移動
          holder.appendChild(model);
          model.object3D.position.copy(marker.object3D.position);
          model.object3D.rotation.copy(marker.object3D.rotation);
        }
      });

      marker.addEventListener("markerLost", () => {
        console.log("⚠️ マーカーを見失いましたが、モデルは残します。");
        // 何もしない（モデルを非表示にしない）
      });
    </script>
  </body>
</html>
